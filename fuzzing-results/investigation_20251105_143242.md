# Fuzzer Investigation Report

## Stopped Fuzzers

Two fuzzers stopped prematurely:
1. fuzz_demod_bpsk - Stopped after 6,820 executions
2. fuzz_demod_qpsk - Stopped after 782 executions

## Root Cause Analysis

Both fuzzers stopped due to **timeout during FFT filter initialization**.

### Stack Trace Analysis

The stack traces show both fuzzers hung during:
- `demod_bpsk_impl::demod_bpsk_impl()` constructor
- `gr::filter::fft_filter_ccf::make()` call
- `gr::filter::kernel::fft_filter_ccf::compute_sizes()` 
- `gr::fft::fft<std::complex<float>>::fft()` constructor
- **Blocked on `pthread_mutex_lock()` in libgnuradio-fft.so**

### Technical Details

1. **FFT Filter Creation**: The demodulators create an FFT filter with root raised cosine taps:
   ```cpp
   d_shaping_filter = gr::filter::fft_filter_ccf::make(
       1, gr::filter::firdes::root_raised_cosine(
           d_samples_per_symbol, d_samples_per_symbol, 1, 0.35, 
           15 * d_samples_per_symbol));
   ```

2. **Filter Size**: With `sps=125`, the filter has `15 * 125 = 1,875` taps, requiring a large FFT size calculation.

3. **Mutex Contention**: The GNU Radio FFT library uses a mutex during filter construction for thread safety. When libFuzzer creates thousands of demodulator instances per second, multiple threads compete for the same mutex, causing:
   - Long wait times (>10 seconds)
   - Deadlock-like behavior
   - Timeout triggers

4. **Fuzzing Pattern**: Each fuzzer input creates a new top_block and demodulator instance, leading to:
   - High frequency of FFT filter constructions
   - Concurrent mutex access
   - Resource contention

### Evidence

- fuzz_demod_bpsk: Hanged after 11 seconds on test case `\004\005\006\000\000\000\000\000\000\000`
- fuzz_demod_qpsk: Hanged after 11 seconds on test case `\356\353`
- Both generated timeout artifacts
- Stack traces show identical mutex lock location

### Impact

- **Coverage**: Both fuzzers made good progress before stopping:
  - fuzz_demod_bpsk: 70 edges, 81 features, 15 new test cases
  - fuzz_demod_qpsk: 75 edges, 86 features, 7 new test cases
  
- **Performance**: Execution speeds were acceptable:
  - fuzz_demod_bpsk: 162 exec/sec
  - fuzz_demod_qpsk: 32 exec/sec (slower due to more complex processing)

### Recommendations

1. **Increase timeout** for these specific fuzzers (e.g., `-timeout=30`)
2. **Pre-create blocks** and reuse them across fuzzer inputs (requires harness modification)
3. **Accept the timeouts** as expected behavior when mutex contention occurs
4. **Use AFL++** instead of libFuzzer for better timeout handling in multi-threaded scenarios

### Conclusion

The timeouts are caused by mutex contention in GNU Radio's FFT library during high-concurrency filter construction. This is a known limitation of using FFT filters in rapid instantiation scenarios. The fuzzers successfully discovered code paths before hitting the timeout condition.
